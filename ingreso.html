<!doctype html>
<html data-bs-theme="auto" lang="en">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content=""><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
	<title>Plantiflex</title>
	<link href="https://getbootstrap.com/docs/5.3/examples/sign-in/" rel="canonical" />
	<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet" />
	<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet" />
	<link href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css" rel="stylesheet" />
</head>
<body class="d-flex align-items-center py-4 bg-body-tertiary">
  <div data-type="ingreso" id="carga-modal-general"></div>

  <nav class="navbar navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <div class="row w-100">
        <div class="col-2">
          <button
            aria-controls="offcanvasDarkNavbar"
            aria-label="Toggle navigation"
            class="navbar-toggler"
            data-bs-target="#offcanvasDarkNavbar"
            data-bs-toggle="offcanvas"
            type="button"
          >
            Menu
          </button>
        </div>
        <div class="col-8">
          <h5 class="text-center text-light mt-1">Ingreso de solicitud</h5>
        </div>
        <div class="col-2"></div>
      </div>
    </div>
  </nav>

  <div aria-labelledby="offcanvasDarkNavbarLabel" class="offcanvas offcanvas-start text-bg-dark" id="offcanvasDarkNavbar" tabindex="-1">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Plantiflex menu</h5>
      <button aria-label="Close" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" type="button"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav justify-content-end flex-grow-1 pe-3" id="menu_lateral"></ul>
    </div>
  </div>

  <div class="container-fluid mt-5">
    <div class="row">
      <div class="col-sm-7">
        <div class="card shadow">
          <div class="card-body">
            <div class="row">
              <div class="col-sm-4"></div>
              <div class="col-sm-4">
                <h5 class="text-center">Datos de paciente</h5>
              </div>
              <div class="col-sm-4 text-end">
                <button
                  class="btn btn-success btn-sm"
                  data-bs-target="#modal-paciente"
                  data-bs-toggle="modal"
                  onclick="datos_paciente()"
                >
                  Selecionar / agregar paciente
                </button>
              </div>
            </div>

            <form class="row g-3" enctype="multipart/form-data" id="order_form" method="post">
              <div class="col-md-3">
                <label class="form-label">R.U.T</label>
                <input class="form-control is-invalid" id="rut" name="rut" onchange="valida_datos();busca_historial()" type="text" />
                <div id="resultado_rut"></div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Nombre del paciente</label>
                <input class="form-control" disabled="disabled" id="nombre" type="text" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Telefono Contacto</label>
                <input class="form-control" disabled="disabled" id="fono" oninput="" type="text" />
                <div id="resultado_rut"></div>
              </div>
              <div class="col-md-3">
                <label class="form-label">Correo</label>
                <input class="form-control" disabled="disabled" id="correo" oninput="" type="text" />
                <div id="resultado_rut"></div>
              </div>

              <hr />

              <h5 class="text-center">Formulario de evaluación</h5>

              <div class="col-md-6">
                <label class="form-label">Ciudad</label>
                <select class="form-control is-valid" id="ciudad" name="ciudad" onchange="valida('ciudad');ciudad();"></select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Convenio</label>
                <select class="form-control" id="convenio" name="convenio"></select>
              </div>

              <div class="col-md-4" id="div_orientacion">
                <label class="form-label">Orientación a imprimir</label>
                <select class="form-select is-valid" id="orientacion" name="orientacion" onchange="valida('orientacion');carga_file();">
                  <option value="izquierda">Izquierda</option>
                  <option selected="selected" value="par">Par</option>
                  <option value="derecha">Derecha</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label" for="inputCity">Cantidad a imprimir</label>
                <input class="form-control is-invalid" id="cantidad" name="cantidad" onchange="valida('cantidad')" type="number" />
              </div>
              <div class="col-md-4">
                <label class="form-label" for="inputCity">Peso del paciente</label>
                <input class="form-control is-invalid" id="peso" name="peso" onchange="valida('peso')" type="number" />
              </div>

              <div class="col-md-4" id="div_iz">
                <label class="form-label" for="inputState">Izquierda (.gcode)</label>
                <input accept=".gcode" class="form-control is-invalid" id="file-iz" name="file-iz" onchange="valida('file-iz');fileValidation('file-iz');" size="15000" type="file" />
              </div>
              <div class="col-md-4" id="div_par">
                <label class="form-label" for="inputZip">Par (.gcode)</label>
                <input accept=".gcode" class="form-control is-invalid" id="file-par" name="file-par" onchange="valida('file-par');fileValidation('file-par');" size="15000" type="file" />
              </div>
              <div class="col-md-4" id="div_der">
                <label class="form-label" for="inputZip">Derecha (.gcode)</label>
                <input accept=".gcode" class="form-control is-invalid" id="file-der" name="file-der" onchange="valida('file-der');fileValidation('file-der');" size="15000" type="file" />
              </div>

              <div class="col-md-2">
                <label class="form-label" for="inputState">Talla (rango 1 - 52)</label>
                <input class="form-control is-invalid" id="talla" max="52" min="1" name="talla" onchange="valida('talla');tipo_talla();" type="number" />
              </div>
              <div class="col-md-2">
                <label class="form-label" for="inputState">Clasificación</label>
                <input class="form-control" disabled="disabled" id="clasifica" type="text" />
              </div>
              <div class="col-md-4">
                <label class="form-label" for="inputZip">Shore (dureza)</label>
                <select class="form-select is-invalid" id="dureza" name="dureza" onchange="valida('dureza')">
                  <option selected="selected"></option>
                  <option>70</option>
                  <option>75</option>
                  <option>80</option>
                  <option>85</option>
                  <option>90</option>
                  <option>95</option>
                  <option>100</option>
                </select>
              </div>
              <div class="col-4">
                <label class="form-label" for="inputAddress">Caracteristica Forro(</label> antimicótico, antideslizante y antitranspirante
                <label class="form-label" for="inputAddress">)</label>
                <select class="form-select is-invalid" id="c_forro" name="c_forro" onchange="valida('c_forro')"></select>
              </div>

              <div class="col-12 text-center">
                <input name="accion" style="display: none;" type="text" value="1" />
                <button class="btn btn-primary" disabled="disabled" id="boton_order" onclick="add_order()" type="button">
                  Realizar solicitud de impresión de plantilla
                </button>
              </div>
            </form>

            <div class="text-center mt-4" id="respuesta"></div>
          </div>
        </div>

        <div class="mt-5">
          <div class="card shadow" id="historial_prin" style="display: none;">
            <div class="card-body">
              <div id="historial"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-5">
        <div class="card shadow">
          <div class="card-body" id="historial-pen"></div>
        </div>
      </div>
    </div>
  </div>
<!-- Modal Paciente -->
<div aria-hidden="true" aria-labelledby="modal-pacienteLabel" class="modal fade modal-xl" id="modal-paciente" tabindex="-1">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="modal-pacienteLabel">Modal title</h1>
              <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
              <div class="container-fluid">
                  <div class="row">
                      <div class="col-sm-12">
                          <div class="row">
                              <div class="col-sm-4"></div>
                              <div class="col-sm-4">
                                  <div class="card" id="div_agregar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Agregar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" id="rut_paciente" maxlength="10" name="rut" required="" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" id="nombre_paciente" name="nombre" required="" type="text" />
                                          <label for="fono">Teléfono:</label>
                                          <input class="form-control" id="fono_paciente" name="fono" type="text" />
                                          <label for="correo">Correo:</label>
                                          <input class="form-control" id="correo_paciente" name="correo" type="text" />
                                          <button class="btn btn-success mt-3 w-100" onclick="guardarDatos()" type="button">Guardar</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">Cancelar</button>
                                      </div>
                                  </div>
                                  <div class="card" id="div_editar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Editar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" disabled="disabled" id="rut_editar" name="rut" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" id="nombre_editar" name="nombre" required="" type="text" />
                                          <label for="fono">Teléfono:</label>
                                          <input class="form-control" id="fono_editar" name="fono" type="text" />
                                          <label for="correo">Correo:</label>
                                          <input class="form-control" id="correo_editar" name="correo" type="text" />
                                          <button class="btn btn-success mt-3 w-100" onclick="editarDatos()" type="button">Guardar</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">Cancelar</button>
                                      </div>
                                  </div>
                                  <div class="card" id="div_eliminar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Eliminar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" disabled="disabled" id="rut_eliminar" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" disabled="disabled" id="nombre_eliminar" type="text" />
                                          <h6 class="text-center">¿Estas seguro?</h6>
                                          <button class="btn btn-success mt-3 w-100" onclick="eliminar()" type="button">SI</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">NO, cancelar operación</button>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-sm-4"></div>
                          </div>
                          <div class="mt-3" id="div-tabla-paciente"></div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal" id="modal-paciente-cerrar" type="button">Cerrar</button>
          </div>
      </div>
  </div>
</div>

<!-- Modal Garantia -->
<div aria-hidden="true" aria-labelledby="modal-garantiaLabel" class="modal fade modal-xl" id="modal-garantia" tabindex="-1">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h1 class="modal-title fs-5" id="modal-garantiaLabel">Modal title</h1>
              <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
          </div>
          <div class="modal-body">
              <div class="container-fluid">
                  <div class="row">
                      <div class="col-sm-12">
                          <div class="row">
                              <div class="col-sm-4"></div>
                              <div class="col-sm-4">
                                  <div class="card" id="div_agregar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Agregar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" id="rut_paciente" maxlength="10" name="rut" required="" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" id="nombre_paciente" name="nombre" required="" type="text" />
                                          <label for="fono">Teléfono:</label>
                                          <input class="form-control" id="fono_paciente" name="fono" type="text" />
                                          <label for="correo">Correo:</label>
                                          <input class="form-control" id="correo_paciente" name="correo" type="text" />
                                          <button class="btn btn-success mt-3 w-100" onclick="guardarDatos()" type="button">Guardar</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">Cancelar</button>
                                      </div>
                                  </div>
                                  <div class="card" id="div_editar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Editar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" disabled="disabled" id="rut_editar" name="rut" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" id="nombre_editar" name="nombre" required="" type="text" />
                                          <label for="fono">Teléfono:</label>
                                          <input class="form-control" id="fono_editar" name="fono" type="text" />
                                          <label for="correo">Correo:</label>
                                          <input class="form-control" id="correo_editar" name="correo" type="text" />
                                          <button class="btn btn-success mt-3 w-100" onclick="editarDatos()" type="button">Guardar</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">Cancelar</button>
                                      </div>
                                  </div>
                                  <div class="card" id="div_eliminar" style="display: none;">
                                      <div class="card-body">
                                          <h5 class="text-center">Eliminar paciente</h5>
                                          <label for="rut">RUT:</label>
                                          <input class="form-control" disabled="disabled" id="rut_eliminar" type="text" />
                                          <label for="nombre">Nombre:</label>
                                          <input class="form-control" disabled="disabled" id="nombre_eliminar" type="text" />
                                          <h6 class="text-center">¿Estas seguro?</h6>
                                          <button class="btn btn-success mt-3 w-100" onclick="eliminar()" type="button">SI</button>
                                          <button class="btn btn-danger mt-3 w-100" onclick="cont_flujo('cancelar')" type="button">NO, cancelar operación</button>
                                      </div>
                                  </div>
                              </div>
                              <div class="col-sm-4"></div>
                          </div>
                          <div class="mt-3" id="div-tabla-paciente"></div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal" id="modal-paciente-cerrar" type="button">Cerrar</button>
          </div>
      </div>
  </div>
</div>




<script src="js/jquery.js"></script>
<script src="js/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script src="js/script.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.js"></script>
<script>
         
            $( document ).ready(function() {
                muestra_datos();
                var parametros = {
                "accion"   : "2"
                };
                $.ajax({            
                    data:  parametros,
                    url: 'php/ingreso.php',
                    type: 'post',  
                    success: function (response) {
                      $("#c_forro").html(response);
                    }
                })
                var parametros = {
                "accion"   : "4"
                };
                $.ajax({            
                    data:  parametros,
                    url: 'php/ingreso.php',
                    type: 'post',  
                    success: function (response) {
                      $("#ciudad").html(response);
                    }
                })
                var parametros = {
                "accion"   : "6"
                };
                $.ajax({            
                    data:  parametros,
                    url: 'php/ingreso.php',
                    type: 'post',  
                    success: function (response) {
                      $("#convenio").html(response);
                    }
                })
                
            });

            $('#modal-paciente').on('hidden.bs.modal', function (event) {
              cont_flujo("cancelar");
            })

            function selecionar(data) {
              $('#rut').val(data);
              valida_datos();
              busca_historial();

              $("#modal-paciente-cerrar").click();
            }

            function cont_flujo(data) {
              if (data === "agregar") {
                $('#div_agregar').show();
                $('#div-tabla-paciente').hide();
                $('#div_editar').hide();
                $('#div_eliminar').hide();
              }
              if (data === "editar") {
                $('#div_agregar').hide();
                $('#div-tabla-paciente').hide();
                $('#div_editar').show();
                $('#div_eliminar').hide();
              }
              if (data==="eliminar") {
                $('#div_agregar').hide();
                $('#div-tabla-paciente').hide();
                $('#div_editar').hide();
                $('#div_eliminar').show();
              }
              if (data==="cancelar") {
                $('#div_agregar').hide();
                $('#div-tabla-paciente').show();
                $('#div_editar').hide();
                $('#div_eliminar').hide();
              }
            }

            function pre_editar(rut, nombre, fono, correo) {
              $('#rut_editar').val(rut);
              $('#nombre_editar').val(nombre);
              $('#fono_editar').val(fono);
              $('#correo_editar').val(correo);
            }
            
            function pre_eliminar(rut, nombre) {
              $('#rut_eliminar').val(rut);
              $('#nombre_eliminar').val(nombre);
            }

            function eliminar() {
              var rut = $('#rut_eliminar').val();

              
              $.ajax({
                url: 'php/ingreso.php', // Reemplaza con la URL correcta
                method: 'POST',
                data: {
                  accion: '11',
                  rut: rut
                },
                success: function(response) {
                  //console.log(response);
                  if (response == 1) {
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-primary" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Paciente eliminado correctamente, actualizando datos...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_eliminar').val("");
                    $('#nombre_eliminar').val("");

                  }
                  if (response == 0) {
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-primary" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Error en consulta,  volviendo a tabla de pacientes...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_eliminar').val("");
                    $('#nombre_eliminar').val("");

                  }
                  
                  
                },
                error: function(error) {
                  console.error(error);
                  
                  //alert('Hubo un error al guardar los datos.');
                }
              });
            }

            function editarDatos() {
              var rut = $('#rut_editar').val();
              var nombre = $('#nombre_editar').val();
              //console.log(nombre);
              if (!rut || !nombre) {
                alert('RUT y Nombre son campos obligatorios. Por favor, ingréselos.');
                return;
              }
              $.ajax({
                url: 'php/ingreso.php', // Reemplaza con la URL correcta
                method: 'POST',
                data: {
                  accion: '10',
                  rut: rut,
                  nombre: nombre,
                  fono: $('#fono_editar').val(),
                  correo: $('#correo_editar').val()
                },
                success: function(response) {
                  //console.log(response);
                  if (response == 1) {
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-primary" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Paciente modificado correctamente, actualizando datos...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_editar').val("");
                    $('#nombre_editar').val("");
                    $('#fono_editar').val("");
                    $('#correo_editar').val("");
                  }
                  if (response == 0) {
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-primary" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Error en consulta,  volviendo a tabla de pacientes...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_editar').val("");
                    $('#nombre_editar').val("");
                    $('#fono_editar').val("");
                    $('#correo_editar').val("");
                  }
                  
                  
                },
                error: function(error) {
                  console.error(error);
                  
                  //alert('Hubo un error al guardar los datos.');
                }
              });
            }
            
            function guardarDatos() {
              var rut = $('#rut_paciente').val();
              var nombre = $('#nombre_paciente').val();
              if (!rut || !nombre) {
                alert('RUT y Nombre son campos obligatorios. Por favor, ingréselos.');
                return;
              }
              $.ajax({
                url: 'php/ingreso.php', // Reemplaza con la URL correcta
                method: 'POST',
                data: {
                  accion: '9',
                  rut: rut,
                  nombre: nombre,
                  fono: $('#fono_paciente').val(),
                  correo: $('#correo_paciente').val()
                },
                success: function(response) {
                  //console.log(response);
                  if (response == 1) {
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-primary" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Paciente agregado correctamente, actualizando datos...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_paciente').val("");
                    $('#nombre_paciente').val("");
                    $('#fono_paciente').val("");
                    $('#correo_paciente').val("");
                  }
                  if(response == 2){
                    cont_flujo("cancelar");
                    $("#div-tabla-paciente").html('<button class="btn btn-danger" type="button" disabled><span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span role="status">Rut duplicado, volviendo a tabla de pacientes...</span></button>');
                    setTimeout(function() {
                      datos_paciente();
                    }, 4000);
                    $('#rut_paciente').val("");
                    $('#nombre_paciente').val("");
                    $('#fono_paciente').val("");
                    $('#correo_paciente').val("");
                  }
                  
                },
                error: function(error) {
                  console.error(error);
                  
                  //alert('Hubo un error al guardar los datos.');
                }
              });
            }
           
            function datos_paciente() {
              var parametros = {
                "accion"   : "7"
                };
                $.ajax({            
                    data:  parametros,
                    url: 'php/ingreso.php',
                    type: 'post',  
                    success: function (response) {
                      $("#div-tabla-paciente").html(response);
                      new DataTable('#tabla-paciente');
                    }
                })
            }

            function valida(identi)
            {
                    //console.log(identi);
                    if ($("#"+identi).val() != "" ) {
                        $("#"+identi).removeClass("is-invalid");
                        $("#"+identi).addClass("is-valid");
                    }else{
                        $("#"+identi).addClass("is-invalid");
                        $("#"+identi).removeClass("is-valid");
                    }

                    
            }

            function valida_datos() {
              if ($("#rut").val() != "" ) {
                 
                    var parametros = {
                    "accion"   : "8",
                    "rut"   : $("#rut").val()
                    };
                    //console.log(parametros);s
                  
                  $.ajax({            
                      data:  parametros,
                      url: 'php/ingreso.php',
                      type: 'post',  
                      dataType: 'json',
                      success: function (response) {
                        console.log(response['nombre']);
                        if (response['rut'] != null && response['rut'] != "") {
                          $("#nombre").val(response['nombre']);
                          $("#fono").val(response['fono']);
                          $("#correo").val(response['correo']);
                          $("#correo").val(response['correo']);
                          $("#boton_order").removeAttr('disabled');
                          $("#rut").removeClass("is-invalid");
                          $("#rut").addClass("is-valid");
                          
                        }else{
                          $("#nombre").val("");
                          $("#fono").val("");
                          $("#correo").val("");
                          $("#boton_order").prop('disabled', true);
                          $("#rut").addClass("is-invalid");
                          $("#rut").removeClass("is-valid");
                        }
                        //console.log(response);
                      }
                  })
              }else{
                $("#nombre").val("");
                $("#fono").val("");
                $("#correo").val("");
                $("#boton_order").prop('disabled', true);
                $("#rut").addClass("is-invalid");
                $("#rut").removeClass("is-valid");
              }

            }
            
            function tipo_talla() {
              var cant = $("#talla").val();

              if (cant < 1 || cant > 52) {
                $("#talla").val("");
                $("#talla").addClass("is-invalid");
                $("#talla").removeClass("is-valid");
              }else{
                if (cant <= 35) {
                  $("#clasifica").val('Niño')
                }else{
                  $("#clasifica").val('Adulto')
                }
              }
              
            }

            function carga_file(){
              $("#div_iz").css("visibility","visible");
              $("#div_der").css("visibility","visible");
              $("#div_par").css("visibility","visible");

              //console.log($("#orientacion").val());
              if ($("#orientacion").val() == 'par' ) {
                $("#div_iz").css("visibility","visible");
                $("#div_der").css("visibility","visible");
                $("#div_par").css("visibility","visible");
              }
              if ($("#orientacion").val() == 'derecha' ) {
                $("#div_par").css("visibility","hidden");
                $("#div_iz").css("visibility","hidden");
              }
              if ($("#orientacion").val() == 'izquierda' ) {
                $("#div_par").css("visibility","hidden");
                $("#div_der").css("visibility", "hidden");
              }
            }

            function fileValidation(pos){
              var fileInput = document.getElementById(pos);
              var filePath = fileInput.value;
              var fileName = fileInput.length;

              var allowedExtensions = /(.gcode)$/i;
              var fileSize = $('#'+pos)[0].files[0].size;
              var siezekiloByte = parseInt(fileSize / 1024);

              if (filePath.length > 62) {
                $('#respuesta').html("<div class='alert alert-warning alert-dismissible fade show' role='alert'><strong>Nombre de archivo demasiado largo:<br>Se permiten nombres de hasta un máximo de 50 caracteres.</strong></div>");
                fileInput.value = '';
                valida(pos);
                desaparecer();
                return false;
              }else if (siezekiloByte >  $(pos).attr('size')) {
                $('#respuesta').html("<div class='alert alert-warning alert-dismissible fade show' role='alert'><strong>Tamaño de documento no permitido:<br>Sólo son permitidos archivos con peso no mayor a 15 MB</strong></div>");
                fileInput.value = '';
                valida(pos);
                desaparecer();
                return false;
              }else if(!allowedExtensions.exec(filePath)){
                $('#respuesta').html("<div class='alert alert-warning alert-dismissible fade show' role='alert'><strong>Formato de documento no permitido:<br>Sólo son permitidos archivos con extensión .GCODE</strong></div>");
                fileInput.value = '';
                valida(pos);
                desaparecer();
                return false;
              }else{
                $('#respuesta').html("");
              }

            }

            function desaparecer(){
               
                  $("#respuesta").css('display','block');
                  setTimeout(function() {		    	
                      $("#respuesta").fadeOut(1500);
                  },3000);
              
            };

           function add_order() {
            var form_data = new FormData(document.getElementById("order_form"));
            console.log(form_data);
                  $.ajax({
                      url: "php/ingreso.php",
                      type: "post",
                      dataType: "html",
                      data: form_data,
                      //dataType: "json",
                      cache: false,
                      contentType: false,
                      processData: false, 
                        beforeSend: function()
                        {
                            $("#respuesta").css('display','block');
                            $("#respuesta").html('<button class="btn btn-primary btn-lg" type="button" disabled>'+
                                                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'+
                                                    ' Ejecutando solicitud, por favor espere</button>');
                        },
                        success: function(response) 
                        {
                          console.log(response);
                          if (response == 0) {
                            $("#respuesta").html('<div class="alert alert-danger" role="alert">Formulario incompleto...</div>');
                            desaparecer();
                          }
                          if (response == 1) {
                            $("#respuesta").html('<div class="alert alert-success" role="alert">Evaluación ingresada correctamente</div>');
                            
                            setTimeout(function() {
                              $("#respuesta").hide();
                            }, 5000);
                            
                            $('#order_form')[0].reset();
                            $('#order_form :input').each(function(){
                                var idElemento = $(this).attr('id');
                                if (idElemento != 'convenio' && idElemento != 'nombre' && idElemento != 'fono' && idElemento != 'correo' && idElemento != 'clasifica') {
                                  valida(idElemento);
                                }
                               
                            });
                            $("#c_forro").addClass("is-invalid");
                            $("#c_forro").removeClass("is-valid");
                            $("#historial_prin").css("display","none");

                            $("#div_iz").css("visibility","visible");
                            $("#div_der").css("visibility","visible");
                            $("#div_par").css("visibility","visible");
                            
                          }
                          if (response == 2) {
                            $("#respuesta").html('<div class="alert alert-danger" role="alert">Error mysql al insertar</div>');
                            desaparecer();
                          }
                          if (response == 3) {
                            $("#respuesta").html('<div class="alert alert-danger" role="alert">error el adjuntar archivo gcode</div>');
                            desaparecer();
                          }
                          muestra_datos()
                          
                        }
                  });
           }
            
            function busca_historial()
            {

                  var total = $("#rut").val()
                  //console.log(total);
                  parametros = {
                    "accion": 3,
                    "rut": total
                  };
                  
                  $.ajax({
                      url: "php/ingreso.php",
                      type: "post",
                      dataType: 'json',
                      data: parametros,
                        beforeSend: function()
                        {
                            $("#historial").css('display','block');
                            $("#historial").html('<button class="btn btn-primary btn-lg" type="button" disabled>'+
                                                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'+
                                                    ' Buscando, por favor espere</button>');
                        },
                        success: function(response) 
                        {
                          //console.log(response);
                            $("#historial_prin").css("display","block");
                            $("#historial").html(response[0]);
                            //$("#nombre").val(response[1]);
                            //valida('nombre');
                        },
                        error: function(error) {
                              // Manejar errores de la solicitud AJAX
                              console.log('Error en la solicitud AJAX:', error);
                          }
                  });
                  
            }
            
            function muestra_datos()
            {

                  parametros = {
                    "accion":5,
                  };
                  $.ajax({
                      url: "php/ingreso.php",
                      type: "post",
                      data: parametros,

                        beforeSend: function()
                        {
                            $("#historial").css('display','block');
                            $("#historial").html('<button class="btn btn-primary btn-lg" type="button" disabled>'+
                                                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'+
                                                    ' Buscando, por favor espere</button>');
                        },
                        success: function(response) 
                        {
                          if (response != "") {
                            $("#historial-pen").html(response);
                          }
                        }
                  })
            }

            
       </script></body>
</html>